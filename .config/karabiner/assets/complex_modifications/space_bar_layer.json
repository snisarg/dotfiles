{
  "title": "Spacebar tap = space, hold = layer",
  "rules": [
    {
      "description": "Hold Space ≥ 200ms = layer; Tap = space; chord = space+key",
      "enabled": false,
      "manipulators": [

        // ─────────────────────────────────────────────────────
        // Spacebar tap-hold logic:
        // - Tap alone → prints space
        // - Hold ≥ 500ms without other keys → activates layer
        // - If chorded (another key pressed), prints space if allowed
        // ─────────────────────────────────────────────────────
        {
          "type": "basic",
          "from": {
            "key_code": "spacebar",
            "modifiers": { "optional": ["any"] }
          },

          // Required to enable `to_after_key_up` behavior
          "to": [
            // Set space_layer intent
            { "set_variable": { "name": "space_layer", "value": 1 } },
            // Flag to indicate that spacebar should be printed if chorded
            { "set_variable": { "name": "space_printed", "value": 1 } }
          ],

          // Fires when spacebar is released, always disables layer
          "to_after_key_up": [
            { "set_variable": { "name": "space_layer", "value": 0 } }
          ],

          // If another key is pressed or space released early (< 500 ms)
          "to_delayed_action": {
            "to_if_canceled": [
              // Reset layer (just in case)
              { "set_variable": { "name": "space_layer", "value": 0 } },
              // Only emit spacebar if space_printed was 1
              {
                "conditions": [
                  { "name": "space_printed", "type": "variable_if", "value": 1 }
                ],
                "key_code": "spacebar"
              },
              // Clear the print flag
              { "set_variable": { "name": "space_printed", "value": 0 } }
            ]
          },

          // Fires if spacebar was tapped alone (no other key)
          "to_if_alone": [
            {
              "conditions": [
                { "name": "space_printed", "type": "variable_if", "value": 1 }
              ],
              "key_code": "spacebar"
            },
            { "set_variable": { "name": "space_printed", "value": 0 } }
          ],

          // Tap and hold timing control
          "parameters": {
            "basic.to_delayed_action_delay_milliseconds": 500,
            "basic.to_if_alone_timeout_milliseconds": 250
          }
        },

        // ─────────────────────────────────────────────────────
        // Layer mapping: E key becomes Up Arrow when layer is on
        // ─────────────────────────────────────────────────────
        {
          "type": "basic",
          "conditions": [
            { "name": "space_layer", "type": "variable_if", "value": 1 }
          ],
          "from": {
            "key_code": "e",
            "modifiers": { "optional": ["any"] }
          },
          "to": [{ "key_code": "up_arrow" }]
        }

        // ➤ Add more mappings like f = left_arrow, d = right_arrow, etc.
      ]
    }
  ]
}

